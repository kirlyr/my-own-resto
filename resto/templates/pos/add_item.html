{% extends 'base.html' %}
{% block content %}
<h4>Order #{{ order.order_no }}</h4>
<div class="row">
  <div class="col-md-7">

    <!-- FILTER & SEARCH -->
    <form class="row g-2 mb-3" method="get">
      <div class="col-md-6">
        <input type="text" class="form-control" name="q" placeholder="Cari nama/kategori..." value="{{ q }}">
      </div>
      <div class="col-md-4">
        <select class="form-select" name="cat">
          <option value="">Semua Kategori</option>
          {% for c in categories %}
            <option value="{{ c.id }}" {% if cat|default:'' == c.id|stringformat:'s' %}selected{% endif %}>{{ c.name }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-2">
        <button class="btn btn-outline-secondary w-100">Terapkan</button>
      </div>
    </form>

    <!-- LIST MENU (pilihan, bukan otomatis masuk order) -->
    <div class="list-group mb-3">
      {% for m in menu %}
        <div class="list-group-item d-flex justify-content-between align-items-center">
          <div>
            <div class="fw-bold">{{ m.name }} ({{ m.category.name }})</div>
            <small>Rp {{ m.price }} | Stok: {{ m.stock_qty }}</small>
          </div>
          <form method="post" class="d-flex">{% csrf_token %}
            <input type="hidden" name="menu_item_id" value="{{ m.id }}">
            <input type="number" name="qty" min="1" max="{{ m.stock_qty }}" value="1"
                   class="form-control form-control-sm me-2" style="width:90px"
                   {% if m.stock_qty == 0 %}disabled{% endif %}>
            <button class="btn btn-primary btn-sm" {% if m.stock_qty == 0 %}disabled{% endif %}>Tambah</button>
          </form>
        </div>
      {% empty %}
        <div class="alert alert-warning">Tidak ada menu sesuai filter.</div>
      {% endfor %}
    </div>

  </div>
  <div class="col-md-5">
    <div class="card">
      <div class="card-header">Ringkasan</div>
      <div class="card-body">

        <ul class="list-group mb-3">
          {% for i in order.items.all %}
            <li class="list-group-item d-flex justify-content-between">
              <span>{{ i.menu_item.name }} Ã— {{ i.qty }}</span>
              <span>Rp {{ i.line_total }}</span>
            </li>
          {% empty %}
            <li class="list-group-item">Belum ada item.</li>
          {% endfor %}
        </ul>

        <p class="mb-1">Subtotal: <strong>Rp {{ order.subtotal }}</strong></p>
        <p class="mb-1">PPN (10%): <strong>Rp {{ order.tax_amount }}</strong></p>
        <p class="mb-3">Grand Total: <strong>Rp {{ order.grand_total }}</strong></p>
        <a class="btn btn-success w-100" href="{% url 'pos_checkout' order.order_no %}">Checkout</a>
      </div>
    </div>
  </div>
</div>
{% endblock %}
